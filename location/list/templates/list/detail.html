{% extends 'base.html' %}

{% block title %}{{ car.marque }} {{ car.model }} - Location de véhicule{% endblock %}

{% block description %}Location de {{ car.marque }} {{ car.model }} {{ car.boite }} {{ car.type_carburant }} au Togo. Véhicule {{ car.nombre_siege }} places, {% if car.climatisation %}avec climatisation{% else %}sans climatisation{% endif %}. Réservation avec ou sans chauffeur.{% endblock %}

{% block og_title %}{{ car.marque }} {{ car.model }} - Location ELONOVACAR{% endblock %}
{% block og_description %}Louez cette {{ car.marque }} {{ car.model }} {{ car.type_carburant }} {{ car.nombre_siege }} places au Togo avec ou sans chauffeur.{% endblock %}
{% block og_image %}{{ car.img_vehicule.url }}{% endblock %}

{% block twitter_title %}{{ car.marque }} {{ car.model }} - Location ELONOVACAR{% endblock %}
{% block twitter_description %}Louez cette {{ car.marque }} {{ car.model }} {{ car.type_carburant }} {{ car.nombre_siege }} places au Togo avec ou sans chauffeur.{% endblock %}
{% block twitter_image %}{{ car.img_vehicule.url }}{% endblock %}

{% block content %}
<style>
    /* Votre CSS reste identique */
</style>

<div class="content-container" itemscope itemtype="https://schema.org/Product">
    {% if messages %}
    <ul class="messages" aria-live="polite">
        {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    <h1 class="page-title" itemprop="name">{{ car.marque }} {{ car.model }}</h1>

    <div class="car-container">
        {% if car.img_vehicule %}
        <div class="car-image-card">
            <div class="car-image-wrapper">
                <img src="{{ car.img_vehicule.url }}" alt="Location {{ car.marque }} {{ car.model }} {{ car.type_carburant }} {{ car.nombre_siege }} places au Togo" itemprop="image" width="600" height="450">
            </div>

            {% if user.is_authenticated %}
            <div class="comment-form">
                <form method="GET">
                    <div class="form-group">
                        <label for="commentaire" class="form-label">Votre commentaire</label>
                        <textarea id="commentaire" name="commentaire" class="form-textarea"
                                  placeholder="Partagez votre expérience avec cette voiture et son chauffeur..."></textarea>
                    </div>
                    <button type="submit" class="submit-btn">Envoyer</button>
                </form>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <div class="car-details-card" itemprop="description">
            <table class="car-specs-table">
                <caption class="sr-only">Caractéristiques du véhicule {{ car.marque }} {{ car.model }}</caption>
                <thead>
                <tr>
                    <th scope="col">Carburant</th>
                    <th scope="col">Climatisation</th>
                    <th scope="col">Boite</th>
                    <th scope="col">Nombre de sièges</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td data-label="Carburant">{{ car.type_carburant }}</td>
                    <td data-label="Climatisation">{{ car.climatisation|yesno:"Oui,Non" }}</td>
                    <td data-label="Boite">{{ car.boite }}</td>
                    <td data-label="Nombre de sièges">{{ car.nombre_siege }}</td>
                </tr>
                </tbody>
            </table>

            <div class="car-price-info" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
                <meta itemprop="priceCurrency" content="XOF" />
                <meta itemprop="availability" content="https://schema.org/InStock" />
                <!-- Ajoutez ici des informations sur les prix si disponibles -->
            </div>
        </div>
    </div>

    <div class="reservation-container">
        <div id="reservation-button">
            <button class="reservation-btn" onclick="showReservationForm()">Réserver maintenant</button>
        </div>

        <div id="reservation-form" class="reservation-form">
            <h2 class="car-subtitle">Réserver cette {{ car.marque }} {{ car.model }}</h2>
            <form method="POST">
                {% csrf_token %}
                {% if not user.is_authenticated %}
                <div class="form-group">
                    <label class="form-label" for="client">Votre nom</label>
                    <input type="text" id="client" name="client" class="form-input" required autocomplete="name">
                </div>
                <div class="form-group">
                    <label class="form-label" for="tel">Votre numéro de téléphone</label>
                    <input type="tel" id="tel" name="tel" class="form-input" required autocomplete="tel" pattern="[0-9]{8,}" title="Veuillez entrer un numéro de téléphone valide">
                </div>
                {% endif %}
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="date-deb">Date de début</label>
                        <input type="date" id="date-deb" name="date_deb" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="date-fin">Date de fin</label>
                        <input type="date" id="date-fin" name="date_fin" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="region">Région</label>
                        <select name="region" id="region" class="form-select" required>
                            <option value="">Sélectionnez une région</option>
                            <option value="maritime">Maritime</option>
                            <option value="plateau">Plateau</option>
                            <option value="centrale">Centrale</option>
                            <option value="kara">Kara</option>
                            <option value="savane">Savane</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="lieu">Lieu de livraison</label>
                        <input type="text" id="lieu" name="lieu" class="form-input" required>
                    </div>

                    <div class="form-group form-full-width">
                        <label class="form-label" for="detail">Détails supplémentaires</label>
                        <textarea id="detail" name="detail_reservation" class="form-textarea"
                                  placeholder="Donnez-nous plus de détails sur votre course (champ non obligatoire)..."></textarea>
                    </div>

                    <div class="form-group form-full-width">
                        <fieldset>
                            <legend class="form-label">Options de location</legend>
                            <div class="form-options">
                                <label class="option-label">
                                    <input type="radio" name="chauffeur" value="avec chauffeur" class="option-radio"
                                        required> Avec chauffeur
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="chauffeur" value="sans chauffeur" class="option-radio"> Sans
                                    chauffeur
                                </label>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Demander un devis</button>
            </form>
        </div>
    </div>
</div>

<!-- Structure de données Schema.org pour les moteurs de recherche -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "RentalCarReservation",
  "reservationFor": {
    "@type": "Car",
    "name": "{{ car.marque }} {{ car.model }}",
    "vehicleConfiguration": "{{ car.nombre_siege }} places",
    "fuelType": "{{ car.type_carburant }}",
    "cargoVolume": {
      "@type": "QuantitativeValue",
      "name": "Nombre de sièges",
      "value": "{{ car.nombre_siege }}"
    },
    "brand": {
      "@type": "Brand",
      "name": "{{ car.marque }}"
    }
  },
  "provider": {
    "@type": "Organization",
    "name": "ELONOVACAR",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Lomé",
      "addressRegion": "Maritime",
      "addressCountry": "Togo"
    }
  }
}
</script>

<script>
    function showReservationForm() {
        document.getElementById('reservation-button').style.display = 'none';
        document.getElementById('reservation-form').style.display = 'block';
    }

    // Définir les dates minimales pour la réservation
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        const formattedDate = today.toISOString().split('T')[0];

        document.getElementById('date-deb').min = formattedDate;
        document.getElementById('date-fin').min = formattedDate;

        // S'assurer que la date de fin est postérieure à la date de début
        document.getElementById('date-deb').addEventListener('change', function() {
            document.getElementById('date-fin').min = this.value;

            // Si la date de fin est antérieure à la nouvelle date de début, la réinitialiser
            if (document.getElementById('date-fin').value < this.value) {
                document.getElementById('date-fin').value = this.value;
            }
        });
    });
</script>
{% endblock %}
